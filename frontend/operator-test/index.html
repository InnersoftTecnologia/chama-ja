<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chamador — Disparar Chamada (Teste)</title>
    <link rel="icon" href="data:," />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: radial-gradient(1200px 600px at 20% 20%, rgba(0, 212, 255, 0.12), transparent 60%),
          #060816;
      }
      .card-glass {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body class="text-white">
    <div class="container py-5" style="max-width: 860px">
      <h1 class="fw-bold mb-2">Disparar chamada (Etapa 1 — teste)</h1>
      <p class="text-white-50 mb-4">
        Isso é temporário para testar TV/SSE/áudio. Depois vira UI de operador de verdade (Etapa 2).
      </p>

      <div class="card card-glass text-white">
        <div class="card-body p-4">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label text-white-50">Senha</label>
              <input id="ticket_code" class="form-control bg-black border border-white border-opacity-10 text-white" placeholder="A-045" value="A-045" />
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label text-white-50">Guichê/Sala</label>
              <input id="counter_name" class="form-control bg-black border border-white border-opacity-10 text-white" placeholder="Guichê 03" value="Guichê 03" />
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label text-white-50">Serviço/Setor</label>
              <input id="service_name" class="form-control bg-black border border-white border-opacity-10 text-white" placeholder="Crédito/Cobrança" value="Atendimento" />
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label text-white-50">Prioridade</label>
              <select id="priority" class="form-select bg-black border border-white border-opacity-10 text-white">
                <option value="normal">Normal</option>
                <option value="preferential">Preferencial</option>
              </select>
            </div>
          </div>

          <div class="d-flex align-items-center gap-2 mt-3">
            <button id="btnCall" class="btn btn-info fw-bold">Chamar agora</button>
            <button id="btnSeed" class="btn btn-outline-light fw-semibold">Seed (avisos/playlist)</button>
          </div>

          <pre id="out" class="mt-3 small bg-black border border-white border-opacity-10 rounded p-3 overflow-auto"></pre>

          <div class="small text-white-50 mt-3">
            <div>Edge: <span id="edgeBase"></span></div>
            <div>Token: <span id="edgeToken"></span></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const EDGE_BASE = (window.EDGE_BASE || `${window.location.protocol}//${window.location.hostname}:7071`).replace(/\/$/, "");
      const EDGE_TOKEN = window.EDGE_TOKEN || "dev-edge-token";
      document.getElementById("edgeBase").textContent = EDGE_BASE;
      document.getElementById("edgeToken").textContent = EDGE_TOKEN;

      function headers() {
        return { Authorization: `Bearer ${EDGE_TOKEN}`, "Content-Type": "application/json" };
      }

      function out(v) {
        document.getElementById("out").textContent = typeof v === "string" ? v : JSON.stringify(v, null, 2);
      }

      document.getElementById("btnCall").addEventListener("click", async () => {
        const payload = {
          ticket_code: document.getElementById("ticket_code").value,
          counter_name: document.getElementById("counter_name").value,
          service_name: document.getElementById("service_name").value,
          priority: document.getElementById("priority").value,
        };
        try {
          const res = await fetch(`${EDGE_BASE}/calls`, {
            method: "POST",
            headers: headers(),
            body: JSON.stringify(payload),
          });
          const data = await res.json();
          out({ status: res.status, data });
        } catch (e) {
          out(String(e));
        }
      });

      document.getElementById("btnSeed").addEventListener("click", async () => {
        try {
          const res = await fetch(`${EDGE_BASE}/admin/seed`, { method: "POST", headers: headers() });
          const data = await res.json();
          out({ status: res.status, data });
        } catch (e) {
          out(String(e));
        }
      });
    </script>
  </body>
</html>

